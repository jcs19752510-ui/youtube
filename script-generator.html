<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìœ íŠœë¸Œ ëŒ€ë³¸ ìƒì„±ê¸°</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* í—¤ë” */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* ë‹¨ê³„ í‘œì‹œ */
        .steps {
            display: flex;
            justify-content: space-around;
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #dee2e6;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 10px;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-title {
            font-size: 14px;
            color: #6c757d;
            font-weight: bold;
        }

        .step.active .step-title {
            color: #667eea;
        }

        /* í™”ë©´ ì˜ì—­ */
        .screen {
            display: none;
            padding: 40px;
            min-height: 500px;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ê³µí†µ ìš”ì†Œ */
        h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            font-size: 16px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.8;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* ë¶„ì„ ê²°ê³¼ */
        .analysis-result {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .analysis-item {
            margin-bottom: 20px;
        }

        .analysis-item h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .analysis-item p {
            line-height: 1.8;
            color: #495057;
        }

        /* ì£¼ì œ ì¹´ë“œ */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .topic-card {
            background: white;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .topic-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .topic-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .topic-card h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .topic-card p {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* ì»¤ìŠ¤í…€ ì£¼ì œ ì…ë ¥ */
        .custom-topic {
            margin: 30px 0;
        }

        .custom-topic input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
        }

        .custom-topic input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ë¡œë”© */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ê²°ê³¼ í‘œì‹œ */
        .result-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 30px;
            line-height: 2;
            font-size: 16px;
            white-space: pre-wrap;
            margin: 20px 0;
        }

        /* ë©”ì‹œì§€ */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .message.active {
            display: block;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header>
            <h1>ğŸ¬ AI ìœ íŠœë¸Œ ëŒ€ë³¸ ìƒì„±ê¸°</h1>
            <p>ë–¡ìƒ ì˜ìƒ ëŒ€ë³¸ì„ ë¶„ì„í•´ ìƒˆë¡œìš´ ì£¼ì œì˜ ëŒ€ë³¸ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤</p>
        </header>

        <!-- ë‹¨ê³„ í‘œì‹œ -->
        <div class="steps">
            <div class="step active" id="step-indicator-1">
                <div class="step-number">1</div>
                <div class="step-title">ëŒ€ë³¸ ì…ë ¥</div>
            </div>
            <div class="step" id="step-indicator-2">
                <div class="step-number">2</div>
                <div class="step-title">ë¶„ì„ ê²°ê³¼</div>
            </div>
            <div class="step" id="step-indicator-3">
                <div class="step-number">3</div>
                <div class="step-title">ì£¼ì œ ì„ íƒ</div>
            </div>
            <div class="step" id="step-indicator-4">
                <div class="step-number">4</div>
                <div class="step-title">ëŒ€ë³¸ ìƒì„±</div>
            </div>
        </div>

        <!-- í™”ë©´ 1: ëŒ€ë³¸ ì…ë ¥ -->
        <div class="screen active" id="screen-1">
            <!-- API í‚¤ ì…ë ¥ (ì²˜ìŒ í•œ ë²ˆë§Œ) -->
            <div id="apiKeySection" style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #856404; margin-bottom: 10px;">ğŸ”‘ OpenAI API í‚¤ ì„¤ì •</h3>
                <p style="font-size: 14px; color: #856404; margin-bottom: 10px;">
                    AI ëŒ€ë³¸ ìƒì„±ì„ ìœ„í•´ OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. 
                    <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #667eea;">ì—¬ê¸°ì—ì„œ ë°œê¸‰</a>
                </p>
                <input type="password" id="apiKeyInput" placeholder="sk-proj-..." 
                       style="width: 100%; padding: 12px; border: 2px solid #ffc107; border-radius: 5px; margin-bottom: 10px;">
                <button class="btn-success" onclick="saveApiKey()" style="margin: 0;">âœ… API í‚¤ ì €ì¥</button>
                <button class="btn-secondary" onclick="toggleApiKey()" style="margin: 0 0 0 10px;">ğŸ‘ï¸ ë³´ê¸°/ìˆ¨ê¸°ê¸°</button>
            </div>

            <h2>ğŸ“ ë–¡ìƒ ì˜ìƒ ëŒ€ë³¸ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
            <textarea id="originalScript" placeholder="ìœ íŠœë¸Œ ë–¡ìƒ ì˜ìƒì˜ ëŒ€ë³¸ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...

ì˜ˆì‹œ:
ì—¬ëŸ¬ë¶„, í˜¹ì‹œ ì´ëŸ° ìƒê° í•´ë³´ì‹  ì  ìˆìœ¼ì„¸ìš”? ì™œ ë‚˜ëŠ” í•­ìƒ ì´ëŸ° ì¼ë§Œ ë‹¹í• ê¹Œ?
ì €ë„ ê·¸ë¬ìŠµë‹ˆë‹¤. 55ë…„ì„ ì‚´ì•„ì˜¤ë©´ì„œ ìˆ˜ì—†ì´ ë§ì€ ìˆœê°„ë“¤ì´ ìˆì—ˆì£ ..."></textarea>
            
            <div class="button-group">
                <button class="btn-primary" onclick="analyzeScript()">ğŸ” ëŒ€ë³¸ ë¶„ì„í•˜ê¸°</button>
                <button class="btn-secondary" onclick="loadSample()">ğŸ“„ ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
            
            <div id="message-1" class="message"></div>
        </div>

        <!-- í™”ë©´ 2: ë¶„ì„ ê²°ê³¼ -->
        <div class="screen" id="screen-2">
            <h2>ğŸ“Š ëŒ€ë³¸ ë¶„ì„ ê²°ê³¼</h2>
            
            <div class="loading" id="loading-analysis">
                <div class="spinner"></div>
                <p>AIê°€ ëŒ€ë³¸ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>

            <div id="analysisResult" class="analysis-result" style="display: none;"></div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="goToScreen(3)">â¡ï¸ ì£¼ì œ ì„ íƒí•˜ê¸°</button>
                <button class="btn-secondary" onclick="goToScreen(1)">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>

        <!-- í™”ë©´ 3: ì£¼ì œ ì„ íƒ -->
        <div class="screen" id="screen-3">
            <h2>ğŸ¯ ìƒˆë¡œìš´ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
            
            <div class="topics-grid" id="topicsGrid">
                <div class="topic-card" onclick="selectTopic(this, 'ì€í‡´ í›„ ì°¾ì•„ì˜¨ ì™¸ë¡œì›€ê³¼ ì •ì²´ì„± í˜¼ë€')">
                    <h3>ğŸ  ì€í‡´ í›„ì˜ ê³ ë…</h3>
                    <p>í‰ìƒ ì¼í•˜ë˜ ì‚¶ì—ì„œ ë²—ì–´ë‚¬ì„ ë•Œ ì°¾ì•„ì˜¤ëŠ” ì •ì²´ì„±ì˜ í˜¼ë€ê³¼ ì™¸ë¡œì›€</p>
                </div>
                <div class="topic-card" onclick="selectTopic(this, 'ì„±ì¸ ìë…€ì™€ì˜ ê°ˆë“±ê³¼ ì„¸ëŒ€ ì°¨ì´')">
                    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ìë…€ì™€ì˜ ê°ˆë“±</h3>
                    <p>ë‹¤ í‚¤ì›Œë†“ì€ ìë…€ì™€ì˜ ì†Œí†µ ë‹¨ì ˆ, ì´í•´ë°›ì§€ ëª»í•˜ëŠ” ë§ˆìŒ</p>
                </div>
                <div class="topic-card" onclick="selectTopic(this, 'ê°±ë…„ê¸°ë¡œ ì¸í•œ ì‹ ì²´ì  ì •ì‹ ì  ë³€í™”')">
                    <h3>ğŸ’« ê°±ë…„ê¸°ì˜ ì§„ì‹¤</h3>
                    <p>ì•„ë¬´ë„ ë§í•´ì£¼ì§€ ì•Šì•˜ë˜ ê°±ë…„ê¸°ì˜ ì‹¤ì²´ì™€ ê·¹ë³µ ê³¼ì •</p>
                </div>
                <div class="topic-card" onclick="selectTopic(this, 'ë…¸í›„ ì¤€ë¹„ ì‹¤íŒ¨ì™€ ê²½ì œì  ë¶ˆì•ˆ')">
                    <h3>ğŸ’° ë…¸í›„ì˜ ë¶ˆì•ˆ</h3>
                    <p>ì¤€ë¹„ë˜ì§€ ì•Šì€ ë…¸í›„, ê²½ì œì  ì••ë°• ì†ì—ì„œ ì°¾ì€ í•´ë‹µ</p>
                </div>
                <div class="topic-card" onclick="selectTopic(this, 'ë°°ìš°ìì™€ì˜ ê´€ê³„ ì¬ì •ë¦½')">
                    <h3>â¤ï¸ ë¶€ë¶€ ê´€ê³„ì˜ ìœ„ê¸°</h3>
                    <p>30ë…„ì„ í•¨ê»˜ ì‚´ì•˜ì§€ë§Œ ë‚¯ì„  ì‚¬ëŒì²˜ëŸ¼ ëŠê»´ì§€ëŠ” ìˆœê°„</p>
                </div>
                <div class="topic-card" onclick="selectTopic(this, 'ëŠ¦ê²Œ ë°œê²¬í•œ ìì‹ ì˜ ê¿ˆê³¼ ì¬ë„ì „')">
                    <h3>ğŸŒŸ 55ì„¸ì˜ ë„ì „</h3>
                    <p>ì´ì œë¼ë„ ëŠ¦ì§€ ì•Šì•˜ë‹¤, ì§„ì§œ ë‚´ ê¿ˆì„ í–¥í•œ ì²«ê±¸ìŒ</p>
                </div>
            </div>

            <div class="custom-topic">
                <h3>ë˜ëŠ” ì§ì ‘ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”:</h3>
                <input type="text" id="customTopic" placeholder="ì˜ˆ: ì¤‘ë…„ ì—¬ì„±ì˜ ì´í˜¼ í›„ ìƒˆë¡œìš´ ì‚¶">
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="generateScript()">âœ¨ ëŒ€ë³¸ ìƒì„±í•˜ê¸°</button>
                <button class="btn-secondary" onclick="goToScreen(2)">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div id="message-3" class="message"></div>
        </div>

        <!-- í™”ë©´ 4: ìƒì„±ëœ ëŒ€ë³¸ -->
        <div class="screen" id="screen-4">
            <h2>ğŸ‰ ìƒì„±ëœ ëŒ€ë³¸</h2>
            
            <div class="loading" id="loading-generation">
                <div class="spinner"></div>
                <p>AIê°€ ìƒˆë¡œìš´ ëŒ€ë³¸ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (30ì´ˆ~1ë¶„ ì†Œìš”)</p>
            </div>

            <div id="generatedScript" class="result-box" style="display: none;"></div>
            
            <div class="button-group">
                <button class="btn-success" onclick="copyScript()">ğŸ“‹ ëŒ€ë³¸ ë³µì‚¬í•˜ê¸°</button>
                <button class="btn-primary" onclick="saveScript()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                <button class="btn-secondary" onclick="goToScreen(3)">ğŸ”„ ë‹¤ë¥¸ ì£¼ì œ ì„ íƒ</button>
                <button class="btn-secondary" onclick="startOver()">ğŸ  ì²˜ìŒë¶€í„°</button>
            </div>
            
            <div id="message-4" class="message"></div>
        </div>
    </div>

    <script>
        // ========================================
        // ì „ì—­ ë³€ìˆ˜
        // ========================================
        let API_KEY = localStorage.getItem('openai_api_key') || '';
        let originalScript = '';
        let analysisData = {};
        let selectedTopic = '';

        // ========================================
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë³µì›
        // ========================================
        window.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            loadApiKey();
        });

        // ========================================
        // API í‚¤ ê´€ë¦¬
        // ========================================
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            if (!apiKey.startsWith('sk-')) {
                alert('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (sk-ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤)');
                return;
            }
            localStorage.setItem('openai_api_key', apiKey);
            API_KEY = apiKey;
            alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
            document.getElementById('apiKeySection').style.background = '#d4edda';
        }

        function loadApiKey() {
            const saved = localStorage.getItem('openai_api_key');
            if (saved) {
                document.getElementById('apiKeyInput').value = saved;
                API_KEY = saved;
                document.getElementById('apiKeySection').style.background = '#d4edda';
            }
        }

        function toggleApiKey() {
            const input = document.getElementById('apiKeyInput');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // ========================================
        // í™”ë©´ ì „í™˜
        // ========================================
        function goToScreen(screenNumber) {
            // ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // ëª¨ë“  ë‹¨ê³„ í‘œì‹œ ì´ˆê¸°í™”
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            // ì„ íƒí•œ í™”ë©´ í‘œì‹œ
            document.getElementById('screen-' + screenNumber).classList.add('active');
            
            // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            for (let i = 1; i < screenNumber; i++) {
                document.getElementById('step-indicator-' + i).classList.add('completed');
            }
            document.getElementById('step-indicator-' + screenNumber).classList.add('active');
            
            // ìŠ¤í¬ë¡¤ ìƒë‹¨ìœ¼ë¡œ
            window.scrollTo(0, 0);
        }

        // ========================================
        // 1ë‹¨ê³„: ëŒ€ë³¸ ë¶„ì„
        // ========================================
        async function analyzeScript() {
            const scriptInput = document.getElementById('originalScript').value.trim();
            
            if (!scriptInput) {
                showMessage('message-1', 'ëŒ€ë³¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            if (!API_KEY) {
                showMessage('message-1', 'OpenAI API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            originalScript = scriptInput;
            
            // ë¡œë”© í‘œì‹œ
            goToScreen(2);
            document.getElementById('loading-analysis').classList.add('active');
            document.getElementById('analysisResult').style.display = 'none';
            
            try {
                // OpenAI API í˜¸ì¶œ
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'system',
                            content: 'ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ëŒ€ë³¸ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ëŒ€ë³¸ì„ ë¶„ì„í•˜ì—¬ êµ¬ì¡°, í›„í‚¹ ì „ëµ, ìŠ¤í† ë¦¬í…”ë§ íŒ¨í„´, ì£¼ìš” í‚¤ì›Œë“œë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.'
                        }, {
                            role: 'user',
                            content: `ë‹¤ìŒ ìœ íŠœë¸Œ ëŒ€ë³¸ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:

${scriptInput}

ë‹¤ìŒ í•­ëª©ë“¤ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. í›„í‚¹ ì „ëµ: ì²« ë¬¸ì¥/ì§ˆë¬¸ì´ ì–´ë–»ê²Œ ì‹œì²­ìë¥¼ ëŒì–´ë“¤ì´ëŠ”ì§€
2. ìŠ¤í† ë¦¬ êµ¬ì¡°: ì‹œì‘-ì „ê°œ-í´ë¼ì´ë§¥ìŠ¤-ê²°ë§ì˜ êµ¬ì¡°
3. ê°ì • íë¦„: ì–´ë–¤ ê°ì •ì„ ì–´ë–»ê²Œ ìê·¹í•˜ëŠ”ì§€
4. í•µì‹¬ í‚¤ì›Œë“œ: ë°˜ë³µë˜ëŠ” ì£¼ì œì™€ ë‹¨ì–´ë“¤
5. ë¬¸ì¥ íŒ¨í„´: ë¬¸ì¥ ê¸¸ì´, ë¦¬ë“¬, í˜¸í¡

ê° í•­ëª©ì„ 2-3ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”.`
                        }],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                const analysis = data.choices[0].message.content;
                analysisData = { fullAnalysis: analysis };
                
                // ê²°ê³¼ í‘œì‹œ
                displayAnalysis(analysis);
                
                // ì €ì¥
                saveToStorage();
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                showMessage('message-1', 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                goToScreen(1);
            } finally {
                document.getElementById('loading-analysis').classList.remove('active');
            }
        }

        // ========================================
        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        // ========================================
        function displayAnalysis(analysis) {
            const resultDiv = document.getElementById('analysisResult');
            resultDiv.innerHTML = `
                <div class="analysis-item">
                    <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
                    <p>${analysis.replace(/\n/g, '<br>')}</p>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        // ========================================
        // ì£¼ì œ ì„ íƒ
        // ========================================
        function selectTopic(card, topic) {
            // ëª¨ë“  ì¹´ë“œ ì„ íƒ í•´ì œ
            document.querySelectorAll('.topic-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // ì„ íƒí•œ ì¹´ë“œ í‘œì‹œ
            card.classList.add('selected');
            selectedTopic = topic;
            
            // ì»¤ìŠ¤í…€ ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('customTopic').value = '';
        }

        // ========================================
        // 4ë‹¨ê³„: ìƒˆ ëŒ€ë³¸ ìƒì„±
        // ========================================
        async function generateScript() {
            // ì£¼ì œ í™•ì¸
            const customTopic = document.getElementById('customTopic').value.trim();
            if (customTopic) {
                selectedTopic = customTopic;
            }
            
            if (!selectedTopic) {
                showMessage('message-3', 'ì£¼ì œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            if (!API_KEY) {
                showMessage('message-3', 'OpenAI API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            goToScreen(4);
            document.getElementById('loading-generation').classList.add('active');
            document.getElementById('generatedScript').style.display = 'none';
            
            try {
                // OpenAI API í˜¸ì¶œ
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'system',
                            content: `ë‹¹ì‹ ì€ 55ì„¸ í•œêµ­ ì—¬ì„±ì„ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ìœ íŠœë¸Œ ëŒ€ë³¸ ì‘ê°€ì…ë‹ˆë‹¤. 
ì‹¬ë¦¬ ìŠ¤ë¦´ëŸ¬í˜• ìŠ¤í† ë¦¬í…”ë§ì„ ì‚¬ìš©í•˜ë©°, ëŠë¦° í˜¸í¡ìœ¼ë¡œ ê¸´ì¥ê°ì„ ê³ ì¡°ì‹œí‚¤ê³ , ì¶©ê²©ì ì¸ ì§ˆë¬¸ìœ¼ë¡œ í›„í‚¹í•©ë‹ˆë‹¤.
êµ¬ì¡°: ì¼ìƒì  ê³ í†µ â†’ ê¸ˆê¸°ì‹œëœ ì‚¬ê±´ â†’ ì§„ì‹¤ ë„ë‹¬ â†’ ìƒˆë¡œìš´ ì‹œì‘`
                        }, {
                            role: 'user',
                            content: `ë‹¤ìŒì€ ë–¡ìƒí•œ ìœ íŠœë¸Œ ì˜ìƒ ëŒ€ë³¸ì…ë‹ˆë‹¤:

${originalScript}

---

ì´ ëŒ€ë³¸ì˜ ë¶„ì„ ê²°ê³¼:
${analysisData.fullAnalysis}

---

ì´ì œ "${selectedTopic}"ë¼ëŠ” ìƒˆë¡œìš´ ì£¼ì œë¡œ, ìœ„ ëŒ€ë³¸ê³¼ ë™ì¼í•œ êµ¬ì¡°, ë™ì¼í•œ í›„í‚¹ ì „ëµ, ë™ì¼í•œ ê°ì • íë¦„ì„ ê°€ì§„ ìƒˆë¡œìš´ ëŒ€ë³¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

ìš”êµ¬ì‚¬í•­:
1. ì¶©ê²©ì ì¸ ì§ˆë¬¸ìœ¼ë¡œ ì‹œì‘ (í›„í‚¹)
2. ì¼ìƒì  ê³ í†µ â†’ ê¸ˆê¸°ì‹œëœ ì‚¬ê±´ â†’ ì§„ì‹¤ ë„ë‹¬ â†’ ìƒˆë¡œìš´ ì‹œì‘ êµ¬ì¡°
3. ëŠë¦° í˜¸í¡, ê¸´ì¥ê° ê³ ì¡°
4. 55ì„¸ í•œêµ­ ì—¬ì„±ì´ ê³µê°í•  ìˆ˜ ìˆëŠ” ì–¸ì–´
5. ì›ë³¸ ëŒ€ë³¸ê³¼ ìœ ì‚¬í•œ ê¸¸ì´ (ìµœì†Œ 500ì ì´ìƒ)
6. ì‹¬ë¦¬ì  ê¹Šì´ì™€ ë‚´ë©´ ê°ˆë“± ë¬˜ì‚¬

ëŒ€ë³¸ë§Œ ì‘ì„±í•´ì£¼ì„¸ìš” (ì„¤ëª…ì´ë‚˜ ì£¼ì„ ì—†ì´).`
                        }],
                        temperature: 0.8,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                const newScript = data.choices[0].message.content;
                
                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('generatedScript').textContent = newScript;
                document.getElementById('generatedScript').style.display = 'block';
                
                // ì €ì¥
                saveToStorage();
                
            } catch (error) {
                console.error('ìƒì„± ì˜¤ë¥˜:', error);
                showMessage('message-4', 'ëŒ€ë³¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                goToScreen(3);
            } finally {
                document.getElementById('loading-generation').classList.remove('active');
            }
        }

        // ========================================
        // ëŒ€ë³¸ ë³µì‚¬
        // ========================================
        function copyScript() {
            const script = document.getElementById('generatedScript').textContent;
            
            navigator.clipboard.writeText(script).then(() => {
                showMessage('message-4', 'ëŒ€ë³¸ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹', 'success');
            }).catch(err => {
                showMessage('message-4', 'ë³µì‚¬ ì‹¤íŒ¨: ' + err.message, 'error');
            });
        }

        // ========================================
        // ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°
        // ========================================
        function saveScript() {
            saveToStorage();
            showMessage('message-4', 'ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾', 'success');
        }

        function saveToStorage() {
            const data = {
                originalScript: originalScript,
                analysisData: analysisData,
                selectedTopic: selectedTopic,
                generatedScript: document.getElementById('generatedScript').textContent,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('scriptGeneratorData', JSON.stringify(data));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('scriptGeneratorData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    originalScript = data.originalScript || '';
                    analysisData = data.analysisData || {};
                    selectedTopic = data.selectedTopic || '';
                    
                    if (originalScript) {
                        document.getElementById('originalScript').value = originalScript;
                    }
                } catch (e) {
                    console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                }
            }
        }

        // ========================================
        // ìƒ˜í”Œ ëŒ€ë³¸ ë¶ˆëŸ¬ì˜¤ê¸°
        // ========================================
        function loadSample() {
            const sample = `ì—¬ëŸ¬ë¶„, í˜¹ì‹œ ì´ëŸ° ìƒê° í•´ë³´ì‹  ì  ìˆìœ¼ì„¸ìš”? 
ì™œ ë‚˜ëŠ” í•­ìƒ ì´ëŸ° ì¼ë§Œ ë‹¹í• ê¹Œ?

ì €ë„ ê·¸ë¬ìŠµë‹ˆë‹¤. 55ë…„ì„ ì‚´ì•„ì˜¤ë©´ì„œ ìˆ˜ì—†ì´ ë§ì€ ìˆœê°„ë“¤ì´ ìˆì—ˆì£ .
ë‚¨í¸ì„ ë’·ë°”ë¼ì§€í•˜ë©°, ì•„ì´ë“¤ì„ í‚¤ìš°ë©°, ì‹œëŒ ëˆˆì¹˜ë¥¼ ë³´ë©°...
ê·¸ë ‡ê²Œ ì‚´ë‹¤ ë³´ë‹ˆ ì–´ëŠìƒˆ ì €ëŠ” ì‚¬ë¼ì ¸ ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ì–´ëŠ ë‚ , ìš°ì—°íˆ ë°œê²¬í•œ í•œ í†µì˜ í¸ì§€.
ê·¸ í¸ì§€ì—ëŠ” ì œê°€ ì ˆëŒ€ ì•Œì•„ì„œëŠ” ì•ˆ ë  ì§„ì‹¤ì´ ë‹´ê²¨ ìˆì—ˆìŠµë‹ˆë‹¤.

ì²˜ìŒì—ëŠ” ë¯¿ì„ ìˆ˜ ì—†ì—ˆì–´ìš”. ì•„ë‹ˆ, ë¯¿ê³  ì‹¶ì§€ ì•Šì•˜ì–´ìš”.
í•˜ì§€ë§Œ í¼ì¦ ì¡°ê°ë“¤ì´ í•˜ë‚˜ì”© ë§ì¶°ì§€ë©´ì„œ
ì œ ì¸ìƒì´ ì–¼ë§ˆë‚˜ í° ê±°ì§“ë§ ìœ„ì— ì„¸ì›Œì ¸ ìˆì—ˆëŠ”ì§€ ê¹¨ë‹¬ì•˜ì£ .

ê·¸ë‚  ë°¤, ì €ëŠ” ê²°ì‹¬í–ˆìŠµë‹ˆë‹¤.
ë” ì´ìƒ ì´ë ‡ê²Œ ì‚´ ìˆ˜ ì—†ë‹¤ê³ .
55ë…„ ë§Œì— ì²˜ìŒìœ¼ë¡œ, ì§„ì§œ ì œ ì¸ìƒì„ ì‚´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì§€ê¸ˆ... ì €ëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ì‚¬ëŒì´ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë‘ë µì§€ë§Œ, ììœ ë¡­ìŠµë‹ˆë‹¤.
ì™¸ë¡­ì§€ë§Œ, ë‹¹ë‹¹í•©ë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ê»˜ë„ ë¬»ê³  ì‹¶ìŠµë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ì¸ìƒì€ ì •ë§ ë‹¹ì‹  ê²ƒì¸ê°€ìš”?`;

            document.getElementById('originalScript').value = sample;
            showMessage('message-1', 'ìƒ˜í”Œ ëŒ€ë³¸ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“„', 'success');
        }

        // ========================================
        // ì²˜ìŒë¶€í„° ë‹¤ì‹œ
        // ========================================
        function startOver() {
            if (confirm('ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                originalScript = '';
                analysisData = {};
                selectedTopic = '';
                document.getElementById('originalScript').value = '';
                document.getElementById('generatedScript').textContent = '';
                goToScreen(1);
            }
        }

        // ========================================
        // ë©”ì‹œì§€ í‘œì‹œ
        // ========================================
        function showMessage(elementId, text, type) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type + ' active';
            
            setTimeout(() => {
                messageDiv.classList.remove('active');
            }, 5000);
        }
    </script>
</body>
</html>